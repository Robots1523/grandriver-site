<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grand River Property Services</title>
    <meta name="description" content="Handyman services in Kitchener, Waterloo, and Cambridge. Free estimates." />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div id="root"></div>

    <!-- Mount your React app (Vite will bundle this) -->
    <script type="module" src="/src/main.jsx"></script>

    <!-- FORCE-FIX: Make ANY visible form submit via Formspree (no mail app) -->
    <script>
      (function() {
        const ENDPOINT = "https://formspree.io/f/xdklvkby";

        function wire(form) {
          if (!form || form.__wired) return;
          form.__wired = true;

          // Kill mailto action or links
          if (form.getAttribute('action') && form.getAttribute('action').startsWith('mailto:')) {
            form.removeAttribute('action');
          }
          form.querySelectorAll('a[href^="mailto:"]').forEach(a => {
            a.addEventListener('click', e => {
              e.preventDefault();
              form.requestSubmit ? form.requestSubmit() : form.submit();
            }, {passive:false});
          });

          // Ensure fields have names so Formspree receives data
          Array.from(form.elements).forEach(el => {
            if ((el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') && !el.name) {
              if (el.type === 'email') el.name = 'email';
              else if (el.tagName === 'TEXTAREA') el.name = 'message';
              else el.name = el.placeholder ? el.placeholder.toLowerCase().replace(/[^a-z0-9]+/g,'_') : 'field';
            }
          });

          // Intercept submit and POST to Formspree
          form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = new FormData(form);

            try {
              const res = await fetch(ENDPOINT, {
                method: 'POST',
                headers: { 'Accept': 'application/json' },
                body: data
              });
              if (res.ok) {
                form.reset();
                form.innerHTML = '<p class="p-4 rounded bg-green-100 text-green-800">Thanks! We\'ll be in touch shortly.</p>';
              } else {
                form.insertAdjacentHTML('beforeend', '<p class="text-red-600 mt-2">Submission failed. Try again.</p>');
              }
            } catch (err) {
              form.insertAdjacentHTML('beforeend', '<p class="text-red-600 mt-2">Network error. Try again.</p>');
            }
          });
        }

        function findAndWire() {
          const visibleForms = Array.from(document.querySelectorAll('form')).filter(f => getComputedStyle(f).display !== 'none');
          visibleForms.forEach(wire);
        }

        document.addEventListener('DOMContentLoaded', findAndWire);
        const mo = new MutationObserver(findAndWire);
        mo.observe(document.documentElement, { childList: true, subtree: true });
      })();
    </script>
  </body>
</html>
